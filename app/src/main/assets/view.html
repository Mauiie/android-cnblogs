<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>博文</title>
    <link type="text/css" rel="stylesheet" href="css/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="css/shCoreDefault.css"/>
    <link rel="stylesheet" type="text/css" href="css/blog-common.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/rae.css" id="RaeStyle">
    <link rel="stylesheet" type="text/css" href="http://www.raeblog.com/cnblogs/Content/app/rae-ext.css" />
    <!--<link rel="stylesheet" type="text/css" href="css/rae-night.css" />-->

    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/highlight.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/highlighter/shCore.js"></script>
    <script type="text/javascript" src="js/highlighter/shAutoloader.js"></script>
    <script src="js/clipboard.min.js" type="text/javascript"></script>
    <script src="js/encode.js" type="text/javascript"></script>
    <script src="js/blog-common.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/rae.js" type="text/javascript"></script>
    <script src="http://www.raeblog.com/cnblogs/Content/app/rae-ext.js" type="text/javascript"></script>
    <script type="text/javascript">
    	var width = 0;

    	// 加载主题
    	function loadTheme(isNightMode){
    		if(typeof(app) !="object"){
    			return;
    		}

    		if(typeof(isNightMode) == "undefined"){
		    	isNightMode = app.isNightMode(); // 是否为夜间模式
		    }
		    if(isNightMode){
		    	$("#RaeStyle").attr("href","css/rae-night.css");
		    }else{
		    	$("#RaeStyle").attr("href","css/rae.css");
		    }
		}
		// 先加载主题
		loadTheme();

		function path() {
			var args = arguments,
			result = [];
			for (var i = 0; i < args.length; i++)
				result.push(args[i].replace('$', 'js/highlighter/'));
			return result
		}

		$(document).ready(function(){
			width = $("body").width();
			load();
			SyntaxHighlighter.autoloader.apply(null, path(
				'applescript            $shBrushAppleScript.js',
				'actionscript3 as3      $shBrushAS3.js',
				'bash shell properties  $shBrushBash.js',
				'coldfusion cf          $shBrushColdFusion.js',
				'cpp c                  $shBrushCpp.js',
				'c# c-sharp csharp      $shBrushCSharp.js',
				'css                    $shBrushCss.js',
				'delphi pascal          $shBrushDelphi.js',
				'diff patch pas         $shBrushDiff.js',
				'erl erlang             $shBrushErlang.js',
				'groovy                 $shBrushGroovy.js',
				'java                   $shBrushJava.js',
				'jfx javafx             $shBrushJavaFX.js',
				'js jscript javascript  $shBrushJScript.js',
				'perl pl                $shBrushPerl.js',
				'php                    $shBrushPhp.js',
				'text plain             $shBrushPlain.js',
				'py python              $shBrushPython.js',
				'ruby rails ror rb      $shBrushRuby.js',
				'sass scss              $shBrushSass.js',
				'scala                  $shBrushScala.js',
				'sql                    $shBrushSql.js',
				'vb vbnet               $shBrushVb.js',
				'xml xhtml xslt html    $shBrushXml.js'
				));
			try{
				SyntaxHighlighter.all();
				markdown_highlight();
			}catch(e){
			}		

			$("table").each(function(key,val){
				setTable(val);
			});

	});

		// 加载图片
		function loadImage(){
			$("img").each(function(key,val){
				var src = $(val).attr("src");

				getImageWidth(src,function(w,h){
					var screenWidth = $(document).width();
			    	// 图片适配屏幕
			    	if(screenWidth>0 && w< screenWidth/2){
			    		$(val).css("width","auto");	    		
			    	}
			    })

				$(val).load(function(){
					$(this).addClass("img-thumbnail");
				});
			});
		}

		function load(){

			loadTheme();
			if(typeof(app) =="object"){
				var blog = app.getBlog();
				if(blog!=""){
					blog = $.parseJSON(blog);
					$("#blog_content").html("");
					$("#blog_title").html(blog.title);
					$("#blog_date").text(blog.postDate);
					if(blog.content==null|| blog.content==""){
						$("#blog_content").append("<p>接口缺失正文内容，可能由于博客发布时间已经久远，接口任性就是没有返回数据。</p><p>你可以尝试点击下面阅读原文阅读，也可以点击右上方的更多按钮查看原文。</p><p><a href='"+blog.url +"' class='a-source'>【阅读原文】</a></p>");
					}else{
						$("#blog_content").append(blog.content);
					}
				}
			}

			try{
                //  官网，调用的方法，适配代码折叠
                fixPostBody();
                loadImage();
                initImage();
                // 重新设置代码高亮
                refreshCodeTheme();
            }catch(e){
            	console.error(e);
            }
        }

    </script>
</head>
<body>
<div class="container-fluid">
    <div id="header">
        <h3 id="blog_title"></h3>
        <span id="blog_date"></span>
        <!--<a href="javascript:window.locatrefreshCategoryload()">刷新页面</a>-->
    </div>
    <div id="blog_content">
       <p>　　这个事情就是一个坑，耽误了两周时间，之前并没有做过ActiveX这玩意，现在客户需求如此，只能说是在网上看着教程做了。</p> <p>　　事情是这样的，有一台海康威视的摄像头，客户需要一个ActiveX控件嵌入到网页中，通过点击按钮开始录制和结束录制来进行视频的录制和保存，关于海康摄像头的二次开发在此就不多说了，可以参考SDK中的说明。</p> <p>　　直接上流程：</p> <h2>　　1.开发环境：</h2> <p>　　　　VS2010,这个打包方便，之前用VS2013打包的，总是调用不了，不知道原因是什么；SDK是32位的，用64位的在Winform中可以正常使用，在网页中使用控件时会报错。</p> <h2>　　2.新建项目：</h2> <p>　　　　新建一个类库项目，如下：</p> <p>&nbsp;</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905165036569-1529357062.png" alt=""></p> <p>　　　　右键点击项目，添加“用户控件”，如下：</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905165442819-1806102050.png" alt=""></p> <p>　　　　界面拖控件，如下：</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905165742944-1605694925.png" alt=""></p> <p>　　　　控件代码如下，其中Guid是“工具”-&gt;“创建GUID”自动生成的，#region-&gt;#endregion折叠部分是实现的IObjectSafety接口</p> <div class="cnblogs_code"><img id="code_img_closed_870b1269-1a52-4a21-855e-47870d2cc10c" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_870b1269-1a52-4a21-855e-47870d2cc10c" class="code_img_opened" style="display: none" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""> <div id="cnblogs_code_open_870b1269-1a52-4a21-855e-47870d2cc10c" class="cnblogs_code_hide"> <pre><span style="color: #0000ff">using</span><span style="color: #000000"> System; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> VideoHelper { [System.Security.SecuritySafeCritical] </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span><span style="color: #000000"> Videos { </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">bool</span> m_initSDK = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;summary&gt;</span> <span style="color: #808080">///</span><span style="color: #008000"> 正在录制 </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;/summary&gt;</span> <span style="color: #0000ff">private</span> <span style="color: #0000ff">bool</span> m_Record = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">uint</span> LastErr = <span style="color: #800080">0</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> Int32 m_RealHandle = -<span style="color: #800080">1</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> Int32 m_lUserID = -<span style="color: #800080">1</span><span style="color: #000000">; </span><span style="color: #0000ff">public</span> IntPtr handle { <span style="color: #0000ff">get</span>; <span style="color: #0000ff">set</span><span style="color: #000000">; } </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> Initialize(<span style="color: #0000ff">string</span> ip = <span style="color: #800000">"</span><span style="color: #800000">192.168.1.64</span><span style="color: #800000">"</span>, <span style="color: #0000ff">int</span> port = <span style="color: #800080">8000</span>, <span style="color: #0000ff">string</span> username = <span style="color: #800000">"</span><span style="color: #800000">admin</span><span style="color: #800000">"</span>, <span style="color: #0000ff">string</span> password = <span style="color: #800000">"</span><span style="color: #800000">8910jqk#</span><span style="color: #800000">"</span><span style="color: #000000">) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { m_initSDK </span>=<span style="color: #000000"> CHCNetSDK.NET_DVR_Init(); </span><span style="color: #0000ff">if</span><span style="color: #000000"> (m_initSDK) { CHCNetSDK.NET_DVR_SetLogToFile(</span><span style="color: #800080">3</span>, <span style="color: #800000">"</span><span style="color: #800000">C:\\SdkLog\\</span><span style="color: #800000">"</span>, <span style="color: #0000ff">true</span><span style="color: #000000">); </span><span style="color: #008000">//</span><span style="color: #008000">设备参数结构体</span> CHCNetSDK.NET_DVR_DEVICEINFO_V30 DeviceInfo = <span style="color: #0000ff">new</span><span style="color: #000000"> CHCNetSDK.NET_DVR_DEVICEINFO_V30(); </span><span style="color: #008000">//</span><span style="color: #008000">注册设备</span> m_lUserID = CHCNetSDK.NET_DVR_Login_V30(ip, port, username, password, <span style="color: #0000ff">ref</span><span style="color: #000000"> DeviceInfo); </span><span style="color: #0000ff">return</span> m_lUserID &gt;= <span style="color: #800080">0</span><span style="color: #000000">; } </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception ex) { System.Windows.Forms.MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">Initialize:</span><span style="color: #800000">"</span> +<span style="color: #000000"> ex.Message); </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } } </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> Start(IntPtr handle, <span style="color: #0000ff">string</span><span style="color: #000000"> filename) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { CHCNetSDK.NET_DVR_PREVIEWINFO lpPreviewInfo </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> CHCNetSDK.NET_DVR_PREVIEWINFO(); lpPreviewInfo.lChannel </span>= <span style="color: #800080">1</span><span style="color: #000000">; lpPreviewInfo.dwLinkMode </span>= <span style="color: #800080">0</span><span style="color: #000000">; lpPreviewInfo.dwStreamType </span>= <span style="color: #800080">0</span><span style="color: #000000">; lpPreviewInfo.bBlocked </span>= <span style="color: #0000ff">true</span><span style="color: #000000">; lpPreviewInfo.dwDisplayBufNum </span>= <span style="color: #800080">15</span><span style="color: #000000">; lpPreviewInfo.hPlayWnd </span>=<span style="color: #000000"> handle; IntPtr pUser </span>= IntPtr.Zero;<span style="color: #008000">//</span><span style="color: #008000">new IntPtr(); </span><span style="color: #008000">//</span><span style="color: #008000">获取实时视频流</span> m_RealHandle = CHCNetSDK.NET_DVR_RealPlay_V40(m_lUserID, <span style="color: #0000ff">ref</span> lpPreviewInfo, <span style="color: #0000ff">null</span><span style="color: #000000">, pUser); </span><span style="color: #0000ff">if</span> (m_Record == <span style="color: #0000ff">false</span><span style="color: #000000">) { CHCNetSDK.NET_DVR_MakeKeyFrame(m_lUserID, </span><span style="color: #800080">1</span><span style="color: #000000">); </span><span style="color: #0000ff">if</span> (!<span style="color: #000000">CHCNetSDK.NET_DVR_SaveRealData(m_RealHandle, filename)) { LastErr </span>=<span style="color: #000000"> CHCNetSDK.NET_DVR_GetLastError(); </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } </span><span style="color: #0000ff">else</span><span style="color: #000000"> { m_Record </span>= <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span><span style="color: #000000">; } } </span><span style="color: #0000ff">else</span><span style="color: #000000"> { </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> { </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } } </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span><span style="color: #000000"> End() { </span><span style="color: #0000ff">if</span><span style="color: #000000"> (m_Record) { </span><span style="color: #0000ff">if</span> (!<span style="color: #000000">CHCNetSDK.NET_DVR_StopSaveRealData(m_RealHandle)) { LastErr </span>=<span style="color: #000000"> CHCNetSDK.NET_DVR_GetLastError(); </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } m_Record </span>= <span style="color: #0000ff">false</span><span style="color: #000000">; m_RealHandle </span>= -<span style="color: #800080">1</span><span style="color: #000000">; </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">true</span><span style="color: #000000">; } </span><span style="color: #0000ff">else</span><span style="color: #000000"> { </span><span style="color: #0000ff">return</span> <span style="color: #0000ff">false</span><span style="color: #000000">; } } </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span><span style="color: #000000"> Dispose() { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { </span><span style="color: #0000ff">if</span> (m_lUserID &gt;= <span style="color: #800080">0</span><span style="color: #000000">) { CHCNetSDK.NET_DVR_Logout_V30(m_lUserID); m_lUserID </span>= -<span style="color: #800080">1</span><span style="color: #000000">; } </span><span style="color: #0000ff">if</span> (m_RealHandle &gt;= <span style="color: #800080">0</span><span style="color: #000000">) { CHCNetSDK.NET_DVR_StopRealPlay(m_RealHandle); m_RealHandle </span>= -<span style="color: #800080">1</span><span style="color: #000000">; } CHCNetSDK.NET_DVR_Cleanup(); } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> { } } } }</span></pre> </div> <span class="cnblogs_code_collapse">录制视频操作类</span></div> <div class="cnblogs_code"><img id="code_img_closed_e42a261c-e309-45af-b5c4-ace6daca1214" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_e42a261c-e309-45af-b5c4-ace6daca1214" class="code_img_opened" style="display: none" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""> <div id="cnblogs_code_open_e42a261c-e309-45af-b5c4-ace6daca1214" class="cnblogs_code_hide"> <pre><span style="color: #0000ff">using</span><span style="color: #000000"> System; </span><span style="color: #0000ff">using</span><span style="color: #000000"> System.Runtime.InteropServices; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> VideoHelper { [ComImport, GuidAttribute(</span><span style="color: #800000">"</span><span style="color: #800000">CB5BDC81-93C1-11CF-8F20-00805F2CD064</span><span style="color: #800000">"</span><span style="color: #000000">)] [InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)] </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">interface</span><span style="color: #000000"> IObjectSafety { [PreserveSig] </span><span style="color: #0000ff">int</span> GetInterfaceSafetyOptions(<span style="color: #0000ff">ref</span> Guid riid, [MarshalAs(UnmanagedType.U4)] <span style="color: #0000ff">ref</span> <span style="color: #0000ff">int</span> pdwSupportedOptions, [MarshalAs(UnmanagedType.U4)] <span style="color: #0000ff">ref</span> <span style="color: #0000ff">int</span><span style="color: #000000"> pdwEnabledOptions); [PreserveSig()] </span><span style="color: #0000ff">int</span> SetInterfaceSafetyOptions(<span style="color: #0000ff">ref</span> Guid riid, [MarshalAs(UnmanagedType.U4)] <span style="color: #0000ff">int</span> dwOptionSetMask, [MarshalAs(UnmanagedType.U4)] <span style="color: #0000ff">int</span><span style="color: #000000"> dwEnabledOptions); } }</span></pre> </div> <span class="cnblogs_code_collapse">接口代码</span></div> <div class="cnblogs_code"><img id="code_img_closed_9191f449-499b-4847-b0d6-cdcd8ba1aa17" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_9191f449-499b-4847-b0d6-cdcd8ba1aa17" class="code_img_opened" style="display: none" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""> <div id="cnblogs_code_open_9191f449-499b-4847-b0d6-cdcd8ba1aa17" class="cnblogs_code_hide"> <pre><span style="color: #0000ff">using</span><span style="color: #000000"> System; </span><span style="color: #0000ff">using</span><span style="color: #000000"> System.Windows.Forms; </span><span style="color: #0000ff">using</span><span style="color: #000000"> System.IO; </span><span style="color: #0000ff">using</span><span style="color: #000000"> System.Runtime.InteropServices; </span><span style="color: #0000ff">namespace</span><span style="color: #000000"> VideoHelper { [System.Security.SecuritySafeCritical] [Guid(</span><span style="color: #800000">"</span><span style="color: #800000">79629620-3C0C-4D47-B93B-2D36AEF8EF31</span><span style="color: #800000">"</span><span style="color: #000000">)] </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">partial</span> <span style="color: #0000ff">class</span><span style="color: #000000"> VideoControl : UserControl,IObjectSafety { </span><span style="color: #0000ff">public</span><span style="color: #000000"> VideoControl() { InitializeComponent(); } </span><span style="color: #0000ff">string</span> videopath =<span style="color: #000000"> Environment.CurrentDirectory; Videos video; IntPtr handle; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> btnLogin_Click(<span style="color: #0000ff">object</span><span style="color: #000000"> sender, EventArgs e) { </span><span style="color: #0000ff">if</span> (btnLogin.Text == <span style="color: #800000">"</span><span style="color: #800000">登录</span><span style="color: #800000">"</span><span style="color: #000000">) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { </span><span style="color: #0000ff">if</span> (<span style="color: #0000ff">string</span>.IsNullOrWhiteSpace(<span style="color: #0000ff">this</span><span style="color: #000000">.txtIP.Text)) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">IP地址不能为空！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">return</span><span style="color: #000000">; } </span><span style="color: #0000ff">if</span> (<span style="color: #0000ff">string</span>.IsNullOrWhiteSpace(<span style="color: #0000ff">this</span><span style="color: #000000">.txtUserID.Text)) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">用户名不能为空！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">return</span><span style="color: #000000">; } </span><span style="color: #0000ff">if</span> (<span style="color: #0000ff">string</span>.IsNullOrWhiteSpace(<span style="color: #0000ff">this</span><span style="color: #000000">.txtPwd.Text)) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">密码不能为空！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">return</span><span style="color: #000000">; } video </span>= <span style="color: #0000ff">new</span><span style="color: #000000"> Videos(); </span><span style="color: #0000ff">if</span> (video.Initialize(<span style="color: #0000ff">this</span>.txtIP.Text, Convert.ToInt32(<span style="color: #0000ff">this</span>.numericUpDown1.Value), <span style="color: #0000ff">this</span>.txtUserID.Text, <span style="color: #0000ff">this</span><span style="color: #000000">.txtPwd.Text)) { </span><span style="color: #0000ff">this</span>.btnLogin.Text = <span style="color: #800000">"</span><span style="color: #800000">注销</span><span style="color: #800000">"</span><span style="color: #000000">; MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">登录成功！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; } </span><span style="color: #0000ff">else</span><span style="color: #000000"> { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">登录失败！</span><span style="color: #800000">"</span><span style="color: #000000">); } } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception ee) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">登录异常：</span><span style="color: #800000">"</span> +<span style="color: #000000"> ee.Message); } } </span><span style="color: #0000ff">else</span> <span style="color: #0000ff">if</span> (btnLogin.Text == <span style="color: #800000">"</span><span style="color: #800000">注销</span><span style="color: #800000">"</span><span style="color: #000000">) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { video.Dispose(); </span><span style="color: #0000ff">this</span>.btnLogin.Text = <span style="color: #800000">"</span><span style="color: #800000">登录</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception ee) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">注销异常：</span><span style="color: #800000">"</span> +<span style="color: #000000"> ee.Message); } } } </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> btnStart_Click(<span style="color: #0000ff">object</span><span style="color: #000000"> sender, EventArgs e) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { </span><span style="color: #0000ff">string</span> filename =<span style="color: #000000"> txtFile.Text.Trim(); </span><span style="color: #0000ff">if</span> (filename.IndexOfAny(Path.GetInvalidFileNameChars()) &gt;= <span style="color: #800080">0</span> || <span style="color: #0000ff">string</span><span style="color: #000000">.IsNullOrWhiteSpace(filename)) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">文件名含有非法字符或空格，请重新输入</span><span style="color: #800000">"</span><span style="color: #000000">); txtFile.Focus(); </span><span style="color: #0000ff">return</span><span style="color: #000000">; } video.Start(handle, filename </span>+<span style="color: #000000"> comboBox1.SelectedItem.ToString()); </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception ee) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">异常：</span><span style="color: #800000">"</span> +<span style="color: #000000"> ee.Message); } } </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> btnSave_Click(<span style="color: #0000ff">object</span><span style="color: #000000"> sender, EventArgs e) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { </span><span style="color: #0000ff">if</span><span style="color: #000000"> (video.End()) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">视频已保存！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; } </span><span style="color: #0000ff">else</span><span style="color: #000000"> { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">保存失败！</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">true</span><span style="color: #000000">; } } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> (Exception ee) { MessageBox.Show(</span><span style="color: #800000">"</span><span style="color: #800000">异常：</span><span style="color: #800000">"</span> +<span style="color: #000000"> ee.Message); } } </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> button1_Click(<span style="color: #0000ff">object</span><span style="color: #000000"> sender, EventArgs e) { </span><span style="color: #0000ff">try</span><span style="color: #000000"> { System.Diagnostics.Process.Start(videopath); } </span><span style="color: #0000ff">catch</span><span style="color: #000000"> { } } </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span> VideoControl_Load(<span style="color: #0000ff">object</span><span style="color: #000000"> sender, EventArgs e) { </span><span style="color: #0000ff">this</span>.comboBox1.SelectedItem = <span style="color: #800000">"</span><span style="color: #800000">.mp4</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.handle =<span style="color: #000000"> pictureBox1.Handle; </span><span style="color: #0000ff">this</span>.btnStart.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Enabled = <span style="color: #0000ff">false</span><span style="color: #000000">; } </span><span style="color: #0000ff">#region</span> IObjectSafety 成员 <span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">string</span> _IID_IDispatch = <span style="color: #800000">"</span><span style="color: #800000">{00020400-0000-0000-C000-000000000046}</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">string</span> _IID_IDispatchEx = <span style="color: #800000">"</span><span style="color: #800000">{a6ef9860-c720-11d0-9337-00a0c90dcaa9}</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">string</span> _IID_IPersistStorage = <span style="color: #800000">"</span><span style="color: #800000">{0000010A-0000-0000-C000-000000000046}</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">string</span> _IID_IPersistStream = <span style="color: #800000">"</span><span style="color: #800000">{00000109-0000-0000-C000-000000000046}</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">string</span> _IID_IPersistPropertyBag = <span style="color: #800000">"</span><span style="color: #800000">{37D84F60-42CB-11CE-8135-00AA004BB851}</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> INTERFACESAFE_FOR_UNTRUSTED_CALLER = <span style="color: #800080">0x00000001</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> INTERFACESAFE_FOR_UNTRUSTED_DATA = <span style="color: #800080">0x00000002</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> S_OK = <span style="color: #800080">0</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> E_FAIL = <span style="color: #0000ff">unchecked</span>((<span style="color: #0000ff">int</span>)<span style="color: #800080">0x80004005</span><span style="color: #000000">); </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">const</span> <span style="color: #0000ff">int</span> E_NOINTERFACE = <span style="color: #0000ff">unchecked</span>((<span style="color: #0000ff">int</span>)<span style="color: #800080">0x80004002</span><span style="color: #000000">); </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">bool</span> _fSafeForScripting = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">private</span> <span style="color: #0000ff">bool</span> _fSafeForInitializing = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">int</span> GetInterfaceSafetyOptions(<span style="color: #0000ff">ref</span> Guid riid, <span style="color: #0000ff">ref</span> <span style="color: #0000ff">int</span> pdwSupportedOptions, <span style="color: #0000ff">ref</span> <span style="color: #0000ff">int</span><span style="color: #000000"> pdwEnabledOptions) { </span><span style="color: #0000ff">int</span> Rslt =<span style="color: #000000"> E_FAIL; </span><span style="color: #0000ff">string</span> strGUID = riid.ToString(<span style="color: #800000">"</span><span style="color: #800000">B</span><span style="color: #800000">"</span><span style="color: #000000">); pdwSupportedOptions </span>= INTERFACESAFE_FOR_UNTRUSTED_CALLER |<span style="color: #000000"> INTERFACESAFE_FOR_UNTRUSTED_DATA; </span><span style="color: #0000ff">switch</span><span style="color: #000000"> (strGUID) { </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IDispatch: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IDispatchEx: Rslt </span>=<span style="color: #000000"> S_OK; pdwEnabledOptions </span>= <span style="color: #800080">0</span><span style="color: #000000">; </span><span style="color: #0000ff">if</span> (_fSafeForScripting == <span style="color: #0000ff">true</span><span style="color: #000000">) pdwEnabledOptions </span>=<span style="color: #000000"> INTERFACESAFE_FOR_UNTRUSTED_CALLER; </span><span style="color: #0000ff">break</span><span style="color: #000000">; </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistStorage: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistStream: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistPropertyBag: Rslt </span>=<span style="color: #000000"> S_OK; pdwEnabledOptions </span>= <span style="color: #800080">0</span><span style="color: #000000">; </span><span style="color: #0000ff">if</span> (_fSafeForInitializing == <span style="color: #0000ff">true</span><span style="color: #000000">) pdwEnabledOptions </span>=<span style="color: #000000"> INTERFACESAFE_FOR_UNTRUSTED_DATA; </span><span style="color: #0000ff">break</span><span style="color: #000000">; </span><span style="color: #0000ff">default</span><span style="color: #000000">: Rslt </span>=<span style="color: #000000"> E_NOINTERFACE; </span><span style="color: #0000ff">break</span><span style="color: #000000">; } </span><span style="color: #0000ff">return</span><span style="color: #000000"> Rslt; } </span><span style="color: #0000ff">public</span> <span style="color: #0000ff">int</span> SetInterfaceSafetyOptions(<span style="color: #0000ff">ref</span> Guid riid, <span style="color: #0000ff">int</span> dwOptionSetMask, <span style="color: #0000ff">int</span><span style="color: #000000"> dwEnabledOptions) { </span><span style="color: #0000ff">int</span> Rslt =<span style="color: #000000"> E_FAIL; </span><span style="color: #0000ff">string</span> strGUID = riid.ToString(<span style="color: #800000">"</span><span style="color: #800000">B</span><span style="color: #800000">"</span><span style="color: #000000">); </span><span style="color: #0000ff">switch</span><span style="color: #000000"> (strGUID) { </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IDispatch: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IDispatchEx: </span><span style="color: #0000ff">if</span> (((dwEnabledOptions &amp; dwOptionSetMask) == INTERFACESAFE_FOR_UNTRUSTED_CALLER) &amp;&amp; (_fSafeForScripting == <span style="color: #0000ff">true</span><span style="color: #000000">)) Rslt </span>=<span style="color: #000000"> S_OK; </span><span style="color: #0000ff">break</span><span style="color: #000000">; </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistStorage: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistStream: </span><span style="color: #0000ff">case</span><span style="color: #000000"> _IID_IPersistPropertyBag: </span><span style="color: #0000ff">if</span> (((dwEnabledOptions &amp; dwOptionSetMask) == INTERFACESAFE_FOR_UNTRUSTED_DATA) &amp;&amp; (_fSafeForInitializing == <span style="color: #0000ff">true</span><span style="color: #000000">)) Rslt </span>=<span style="color: #000000"> S_OK; </span><span style="color: #0000ff">break</span><span style="color: #000000">; </span><span style="color: #0000ff">default</span><span style="color: #000000">: Rslt </span>=<span style="color: #000000"> E_NOINTERFACE; </span><span style="color: #0000ff">break</span><span style="color: #000000">; } </span><span style="color: #0000ff">return</span><span style="color: #000000"> Rslt; } </span><span style="color: #0000ff">#endregion</span><span style="color: #000000"> } }</span></pre> </div> <span class="cnblogs_code_collapse">控件代码</span></div> <div class="cnblogs_code"><img id="code_img_closed_ea2d4e4a-5f80-4c6b-abfd-cd4f8d8054e1" class="code_img_closed" src="http://images.cnblogs.com/OutliningIndicators/ContractedBlock.gif" alt=""><img id="code_img_opened_ea2d4e4a-5f80-4c6b-abfd-cd4f8d8054e1" class="code_img_opened" style="display: none" src="http://images.cnblogs.com/OutliningIndicators/ExpandedBlockStart.gif" alt=""> <div id="cnblogs_code_open_ea2d4e4a-5f80-4c6b-abfd-cd4f8d8054e1" class="cnblogs_code_hide"> <pre><span style="color: #0000ff">namespace</span><span style="color: #000000"> VideoHelper { </span><span style="color: #0000ff">partial</span> <span style="color: #0000ff">class</span><span style="color: #000000"> VideoControl { </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;summary&gt;</span> <span style="color: #808080">///</span><span style="color: #008000"> 必需的设计器变量。 </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;/summary&gt;</span> <span style="color: #0000ff">private</span> System.ComponentModel.IContainer components = <span style="color: #0000ff">null</span><span style="color: #000000">; </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;summary&gt;</span> <span style="color: #808080">///</span><span style="color: #008000"> 清理所有正在使用的资源。 </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;/summary&gt;</span> <span style="color: #808080">///</span> <span style="color: #808080">&lt;param name="disposing"&gt;</span><span style="color: #008000">如果应释放托管资源，为 true；否则为 false。</span><span style="color: #808080">&lt;/param&gt;</span> <span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> Dispose(<span style="color: #0000ff">bool</span><span style="color: #000000"> disposing) { </span><span style="color: #0000ff">if</span> (disposing &amp;&amp; (components != <span style="color: #0000ff">null</span><span style="color: #000000">)) { components.Dispose(); } </span><span style="color: #0000ff">base</span><span style="color: #000000">.Dispose(disposing); } </span><span style="color: #0000ff">#region</span> 组件设计器生成的代码 <span style="color: #808080">///</span> <span style="color: #808080">&lt;summary&gt;</span> <span style="color: #808080">///</span><span style="color: #008000"> 设计器支持所需的方法 - 不要 </span><span style="color: #808080">///</span><span style="color: #008000"> 使用代码编辑器修改此方法的内容。 </span><span style="color: #808080">///</span> <span style="color: #808080">&lt;/summary&gt;</span> <span style="color: #0000ff">private</span> <span style="color: #0000ff">void</span><span style="color: #000000"> InitializeComponent() { </span><span style="color: #0000ff">this</span>.button1 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Button(); </span><span style="color: #0000ff">this</span>.comboBox1 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.ComboBox(); </span><span style="color: #0000ff">this</span>.label4 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Label(); </span><span style="color: #0000ff">this</span>.txtFile = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.TextBox(); </span><span style="color: #0000ff">this</span>.btnSave = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Button(); </span><span style="color: #0000ff">this</span>.btnStart = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Button(); </span><span style="color: #0000ff">this</span>.btnLogin = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Button(); </span><span style="color: #0000ff">this</span>.label3 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Label(); </span><span style="color: #0000ff">this</span>.txtPwd = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.TextBox(); </span><span style="color: #0000ff">this</span>.label2 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Label(); </span><span style="color: #0000ff">this</span>.txtUserID = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.TextBox(); </span><span style="color: #0000ff">this</span>.label1 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Label(); </span><span style="color: #0000ff">this</span>.numericUpDown1 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.NumericUpDown(); </span><span style="color: #0000ff">this</span>.IP = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.Label(); </span><span style="color: #0000ff">this</span>.txtIP = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.TextBox(); </span><span style="color: #0000ff">this</span>.pictureBox1 = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Windows.Forms.PictureBox(); ((System.ComponentModel.ISupportInitialize)(</span><span style="color: #0000ff">this</span><span style="color: #000000">.numericUpDown1)).BeginInit(); ((System.ComponentModel.ISupportInitialize)(</span><span style="color: #0000ff">this</span><span style="color: #000000">.pictureBox1)).BeginInit(); </span><span style="color: #0000ff">this</span><span style="color: #000000">.SuspendLayout(); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> button1 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.button1.Cursor =<span style="color: #000000"> System.Windows.Forms.Cursors.Hand; </span><span style="color: #0000ff">this</span>.button1.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.button1.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">377</span>, <span style="color: #800080">360</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.button1.Name = <span style="color: #800000">"</span><span style="color: #800000">button1</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.button1.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">138</span>, <span style="color: #800080">22</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.button1.TabIndex = <span style="color: #800080">58</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.button1.Text = <span style="color: #800000">"</span><span style="color: #800000">打开视频存放位置</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.button1.UseVisualStyleBackColor = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.button1.Click += <span style="color: #0000ff">new</span> System.EventHandler(<span style="color: #0000ff">this</span><span style="color: #000000">.button1_Click); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> comboBox1 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.comboBox1.DropDownStyle =<span style="color: #000000"> System.Windows.Forms.ComboBoxStyle.DropDownList; </span><span style="color: #0000ff">this</span>.comboBox1.FlatStyle =<span style="color: #000000"> System.Windows.Forms.FlatStyle.Flat; </span><span style="color: #0000ff">this</span>.comboBox1.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.comboBox1.FormattingEnabled = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.comboBox1.Items.AddRange(<span style="color: #0000ff">new</span> <span style="color: #0000ff">object</span><span style="color: #000000">[] { </span><span style="color: #800000">"</span><span style="color: #800000">.mp4</span><span style="color: #800000">"</span><span style="color: #000000">, </span><span style="color: #800000">"</span><span style="color: #800000">.avi</span><span style="color: #800000">"</span><span style="color: #000000">, </span><span style="color: #800000">"</span><span style="color: #800000">.wmv</span><span style="color: #800000">"</span><span style="color: #000000">, </span><span style="color: #800000">"</span><span style="color: #800000">.3gp</span><span style="color: #800000">"</span><span style="color: #000000">, </span><span style="color: #800000">"</span><span style="color: #800000">.flv</span><span style="color: #800000">"</span><span style="color: #000000">}); </span><span style="color: #0000ff">this</span>.comboBox1.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">303</span>, <span style="color: #800080">361</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.comboBox1.Name = <span style="color: #800000">"</span><span style="color: #800000">comboBox1</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.comboBox1.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">55</span>, <span style="color: #800080">25</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.comboBox1.TabIndex = <span style="color: #800080">57</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> label4 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.label4.AutoSize = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label4.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.label4.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">14</span>, <span style="color: #800080">360</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label4.Name = <span style="color: #800000">"</span><span style="color: #800000">label4</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label4.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">116</span>, <span style="color: #800080">17</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label4.TabIndex = <span style="color: #800080">56</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label4.Text = <span style="color: #800000">"</span><span style="color: #800000">请输入视频文件名：</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> txtFile </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.txtFile.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">136</span>, <span style="color: #800080">360</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtFile.Name = <span style="color: #800000">"</span><span style="color: #800000">txtFile</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtFile.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">161</span>, <span style="color: #800080">21</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtFile.TabIndex = <span style="color: #800080">55</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> btnSave </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.btnSave.Cursor =<span style="color: #000000"> System.Windows.Forms.Cursors.Hand; </span><span style="color: #0000ff">this</span>.btnSave.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, <span style="color: #800080">10.5F</span>, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.btnSave.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">490</span>, <span style="color: #800080">298</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnSave.Name = <span style="color: #800000">"</span><span style="color: #800000">btnSave</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">57</span>, <span style="color: #800080">45</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnSave.TabIndex = <span style="color: #800080">54</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Text = <span style="color: #800000">"</span><span style="color: #800000">保存</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.UseVisualStyleBackColor = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnSave.Click += <span style="color: #0000ff">new</span> System.EventHandler(<span style="color: #0000ff">this</span><span style="color: #000000">.btnSave_Click); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> btnStart </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.btnStart.Cursor =<span style="color: #000000"> System.Windows.Forms.Cursors.Hand; </span><span style="color: #0000ff">this</span>.btnStart.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, <span style="color: #800080">10.5F</span>, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.btnStart.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">421</span>, <span style="color: #800080">298</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnStart.Name = <span style="color: #800000">"</span><span style="color: #800000">btnStart</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnStart.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">57</span>, <span style="color: #800080">45</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnStart.TabIndex = <span style="color: #800080">53</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnStart.Text = <span style="color: #800000">"</span><span style="color: #800000">录制</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnStart.UseVisualStyleBackColor = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnStart.Click += <span style="color: #0000ff">new</span> System.EventHandler(<span style="color: #0000ff">this</span><span style="color: #000000">.btnStart_Click); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> btnLogin </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.btnLogin.Cursor =<span style="color: #000000"> System.Windows.Forms.Cursors.Hand; </span><span style="color: #0000ff">this</span>.btnLogin.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, <span style="color: #800080">10.5F</span>, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.btnLogin.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">352</span>, <span style="color: #800080">298</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnLogin.Name = <span style="color: #800000">"</span><span style="color: #800000">btnLogin</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnLogin.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">57</span>, <span style="color: #800080">45</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.btnLogin.TabIndex = <span style="color: #800080">52</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnLogin.Text = <span style="color: #800000">"</span><span style="color: #800000">登录</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnLogin.UseVisualStyleBackColor = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.btnLogin.Click += <span style="color: #0000ff">new</span> System.EventHandler(<span style="color: #0000ff">this</span><span style="color: #000000">.btnLogin_Click); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> label3 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.label3.AutoSize = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label3.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.label3.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">172</span>, <span style="color: #800080">325</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label3.Name = <span style="color: #800000">"</span><span style="color: #800000">label3</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label3.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">44</span>, <span style="color: #800080">17</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label3.TabIndex = <span style="color: #800080">51</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label3.Text = <span style="color: #800000">"</span><span style="color: #800000">密码：</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> txtPwd </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.txtPwd.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">221</span>, <span style="color: #800080">322</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtPwd.Name = <span style="color: #800000">"</span><span style="color: #800000">txtPwd</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtPwd.PasswordChar = <span style="color: #800000">'</span><span style="color: #800000">*</span><span style="color: #800000">'</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtPwd.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">115</span>, <span style="color: #800080">21</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtPwd.TabIndex = <span style="color: #800080">50</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtPwd.Text = <span style="color: #800000">"</span><span style="color: #800000">8910jqk#</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtPwd.UseSystemPasswordChar = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> label2 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.label2.AutoSize = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label2.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.label2.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">8</span>, <span style="color: #800080">322</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label2.Name = <span style="color: #800000">"</span><span style="color: #800000">label2</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label2.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">44</span>, <span style="color: #800080">17</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label2.TabIndex = <span style="color: #800080">49</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label2.Text = <span style="color: #800000">"</span><span style="color: #800000">用户名</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> txtUserID </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.txtUserID.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">66</span>, <span style="color: #800080">322</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtUserID.Name = <span style="color: #800000">"</span><span style="color: #800000">txtUserID</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtUserID.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">100</span>, <span style="color: #800080">21</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtUserID.TabIndex = <span style="color: #800080">48</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtUserID.Text = <span style="color: #800000">"</span><span style="color: #800000">admin</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> label1 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.label1.AutoSize = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label1.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.label1.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">172</span>, <span style="color: #800080">295</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label1.Name = <span style="color: #800000">"</span><span style="color: #800000">label1</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label1.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">44</span>, <span style="color: #800080">17</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.label1.TabIndex = <span style="color: #800080">47</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.label1.Text = <span style="color: #800000">"</span><span style="color: #800000">端口：</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> numericUpDown1 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.numericUpDown1.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">222</span>, <span style="color: #800080">295</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.numericUpDown1.Maximum = <span style="color: #0000ff">new</span> <span style="color: #0000ff">decimal</span>(<span style="color: #0000ff">new</span> <span style="color: #0000ff">int</span><span style="color: #000000">[] { </span><span style="color: #800080">65535</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">}); </span><span style="color: #0000ff">this</span>.numericUpDown1.Minimum = <span style="color: #0000ff">new</span> <span style="color: #0000ff">decimal</span>(<span style="color: #0000ff">new</span> <span style="color: #0000ff">int</span><span style="color: #000000">[] { </span><span style="color: #800080">1</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">}); </span><span style="color: #0000ff">this</span>.numericUpDown1.Name = <span style="color: #800000">"</span><span style="color: #800000">numericUpDown1</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.numericUpDown1.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">114</span>, <span style="color: #800080">21</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.numericUpDown1.TabIndex = <span style="color: #800080">46</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.numericUpDown1.Value = <span style="color: #0000ff">new</span> <span style="color: #0000ff">decimal</span>(<span style="color: #0000ff">new</span> <span style="color: #0000ff">int</span><span style="color: #000000">[] { </span><span style="color: #800080">8000</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">, </span><span style="color: #800080">0</span><span style="color: #000000">}); </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> IP </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.IP.AutoSize = <span style="color: #0000ff">true</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.IP.Font = <span style="color: #0000ff">new</span> System.Drawing.Font(<span style="color: #800000">"</span><span style="color: #800000">微软雅黑</span><span style="color: #800000">"</span>, 9F, System.Drawing.FontStyle.Regular, System.Drawing.GraphicsUnit.Point, ((<span style="color: #0000ff">byte</span>)(<span style="color: #800080">134</span><span style="color: #000000">))); </span><span style="color: #0000ff">this</span>.IP.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">20</span>, <span style="color: #800080">295</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.IP.Name = <span style="color: #800000">"</span><span style="color: #800000">IP</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.IP.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">19</span>, <span style="color: #800080">17</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.IP.TabIndex = <span style="color: #800080">45</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.IP.Text = <span style="color: #800000">"</span><span style="color: #800000">IP</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> txtIP </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.txtIP.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">66</span>, <span style="color: #800080">295</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtIP.Name = <span style="color: #800000">"</span><span style="color: #800000">txtIP</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtIP.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">100</span>, <span style="color: #800080">21</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.txtIP.TabIndex = <span style="color: #800080">44</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.txtIP.Text = <span style="color: #800000">"</span><span style="color: #800000">192.168.1.64</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> pictureBox1 </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.pictureBox1.Location = <span style="color: #0000ff">new</span> System.Drawing.Point(<span style="color: #800080">5</span>, <span style="color: #800080">5</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.pictureBox1.Name = <span style="color: #800000">"</span><span style="color: #800000">pictureBox1</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.pictureBox1.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">542</span>, <span style="color: #800080">269</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.pictureBox1.TabIndex = <span style="color: #800080">43</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.pictureBox1.TabStop = <span style="color: #0000ff">false</span><span style="color: #000000">; </span><span style="color: #008000">//</span> <span style="color: #008000">//</span><span style="color: #008000"> VideoControl </span><span style="color: #008000">//</span> <span style="color: #0000ff">this</span>.AutoScaleDimensions = <span style="color: #0000ff">new</span><span style="color: #000000"> System.Drawing.SizeF(6F, 12F); </span><span style="color: #0000ff">this</span>.AutoScaleMode =<span style="color: #000000"> System.Windows.Forms.AutoScaleMode.Font; </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.button1); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.comboBox1); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.label4); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.txtFile); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.btnSave); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.btnStart); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.btnLogin); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.label3); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.txtPwd); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.label2); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.txtUserID); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.label1); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.numericUpDown1); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.IP); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.txtIP); </span><span style="color: #0000ff">this</span>.Controls.Add(<span style="color: #0000ff">this</span><span style="color: #000000">.pictureBox1); </span><span style="color: #0000ff">this</span>.Name = <span style="color: #800000">"</span><span style="color: #800000">VideoControl</span><span style="color: #800000">"</span><span style="color: #000000">; </span><span style="color: #0000ff">this</span>.Size = <span style="color: #0000ff">new</span> System.Drawing.Size(<span style="color: #800080">556</span>, <span style="color: #800080">398</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span>.Load += <span style="color: #0000ff">new</span> System.EventHandler(<span style="color: #0000ff">this</span><span style="color: #000000">.VideoControl_Load); ((System.ComponentModel.ISupportInitialize)(</span><span style="color: #0000ff">this</span><span style="color: #000000">.numericUpDown1)).EndInit(); ((System.ComponentModel.ISupportInitialize)(</span><span style="color: #0000ff">this</span><span style="color: #000000">.pictureBox1)).EndInit(); </span><span style="color: #0000ff">this</span>.ResumeLayout(<span style="color: #0000ff">false</span><span style="color: #000000">); </span><span style="color: #0000ff">this</span><span style="color: #000000">.PerformLayout(); } </span><span style="color: #0000ff">#endregion</span> <span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Button button1; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.ComboBox comboBox1; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Label label4; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.TextBox txtFile; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Button btnSave; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Button btnStart; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Button btnLogin; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Label label3; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.TextBox txtPwd; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Label label2; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.TextBox txtUserID; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Label label1; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.NumericUpDown numericUpDown1; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.Label IP; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.TextBox txtIP; </span><span style="color: #0000ff">private</span><span style="color: #000000"> System.Windows.Forms.PictureBox pictureBox1; } }</span></pre> </div> <span class="cnblogs_code_collapse">控件设计器代码</span></div> <p>　　　　至此，此项目结束。</p> <p>　　　　右键点击解决方案，添加新项目，如下，至于为什么建立两个项目，我一会儿在下面解释，</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905171336163-859668687.png" alt=""></p> <p>　　　　在HkHelper项目中添加类CHCNetSDK.cs，此类是海康提供的，可以在官网找到</p> <p>　　　　接下来，最重要的，项目属性设置如下，两个项目都要设置：</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905173453288-1588777407.png" alt=""></p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905173525913-322631175.png" alt=""></p> <p>　　　　至此，自定义控件已经完成，接下来就是打包，新建一个安装项目：</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905173709944-1935607201.png" alt=""></p> <p>　　　　右键点击安装项目，“添加”-&gt;“项目输出”，并选择自定义控件的项目，然后确定</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905173820272-725585573.png" alt=""></p> <p>&nbsp;</p> <p>&nbsp;　　　　然后添加海康提供的SDK的库文件文件夹下的所有文件和文件夹到项目中，如下：</p> <p><img style="display: block; margin-left: auto; margin-right: auto" src="http://images2017.cnblogs.com/blog/1230296/201709/1230296-20170905174033726-639370000.png" alt=""></p> <p>　　　　然后生成项目，会生成setup.exe和SetupVideo.msi两个文件，然后用打包文件，把这两个文件打包称cab文件就OK了</p> <p>&nbsp;</p> <p>&nbsp;打包文件一共三个cabarc.exe、build.bat、install.inf</p> <p>build.bat文件：</p> <div class="cnblogs_code"> <pre><span style="color: #800000">"</span><span style="color: #800000">cabarc.exe</span><span style="color: #800000">"</span> n VideoSetup.cab SetupVideo.msi install.inf</pre> </div> <p>install.inf文件：</p> <div class="cnblogs_code"> <pre><span style="color: #000000">[version] signature</span>=<span style="color: #800000">"</span><span style="color: #800000">$CHICAGO$</span><span style="color: #800000">"</span><span style="color: #000000"> AdvancedINF</span>=<span style="color: #800080">2.0</span><span style="color: #000000"> [Setup Hooks] hook1</span>=<span style="color: #000000">hook1 [hook1] run</span>=msiexec.exe /i <span style="color: #800000">"</span><span style="color: #800000">%EXTRACT_DIR%\SetupVideo.msi</span><span style="color: #800000">"</span> /qn</pre> </div> <p>cabarc.exe是微软提供的工具</p> <p>&nbsp;</p> <p>最后说一下为什么要分为两个项目去实现控件，那是因为如果在一个项目中的话，调用海康动态库的类CHCNetSDK.cs不能进行COM注册</p> <p>&nbsp;</p> <p>本文原创，未经允许，禁止转载！！！&nbsp;</p> <p>&nbsp;</p>
    </div>


</div>
</body>
</html>